@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix ex: <https://example.org/ns/example#> .
@prefix schema: <https://schema.org/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix ops: <https://data.vlaanderen.be/shacl/persoon-basis#> .
@prefix o-steps: <https://fast.ilabt.imec.be/ns/oslo-steps/0.2#> .
@prefix o-persoon: <https://data.vlaanderen.be/ns/persoon#> .

@prefix state: <{{base}}/states#> .
@prefix shape: <{{base}}/shapes#> .
@prefix step: <{{base}}/steps#> .



# needed for advanced shacl, to use prefixes in SPARQL query string
<https://schema.org/> sh:prefix "schema" .
<https://data.vlaanderen.be/doc/applicatieprofiel/persoon-basis#> sh:prefix "o-persoon" .


#
# first name (state shape)
#
shape:firstNameShape a o-steps:StateShape ;
  rdfs:label "A citizen's first name"@en ;
  rdfs:comment "User with valid first name"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:firstNameLength .

shape:firstNameLength a sh:PropertyShape ;
  rdfs:label "First name length constraints"@en ;
  rdfs:comment "Minimum and maximum for a valid first name"@en ;
  sh:path foaf:givenName ;
  sh:minLength 2 ;
  sh:maxLength 25 .

#
# first name (ui shape)
#
shape:firstNameUIShape a o-steps:UIShape ;
  rdfs:label "UI shape: first name"@en ;
  rdfs:comment ""@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property [
    sh:path foaf:givenName ;
    sh:datatype xsd:string ;
  ] .

#
# last name (state shape)
#
shape:lastNameShape a o-steps:StateShape ;
  rdfs:label "A citizen's last name"@en ;
  rdfs:comment "User with valid first name"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:lastNameLength .

shape:lastNameLength a sh:PropertyShape ;
  rdfs:label "First name length constraints"@en ;
  rdfs:comment "Minimum and maximum for a valid first name"@en ;
  sh:path foaf:familyName ;
  sh:minLength 2 ;
  sh:maxLength 55 .

#
# last name (ui shape)
#
shape:lastNameUIShape a o-steps:UIShape ;
  rdfs:label "UI shape: last name"@en ;
  rdfs:comment ""@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property [
    sh:path foaf:familyName ;
    sh:datatype xsd:string ;
  ] .



#
# gender constraints (state)
#
shape:genderShape a o-steps:StateShape ;
  rdfs:label "A citizen's gender"@en ;
  rdfs:comment "User with a valid gender"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:genderValidValues .

shape:genderValidValues a sh:PropertyShape ;
  rdfs:label "Valid gender values"@en ;
  sh:path o-persoon:geslacht ;
  sh:in ( "male" "female" ) .

#
# gender constraints (UI)
#
shape:genderMale a skos:Concept ;
  rdfs:label "male gender"@en ;
  rdfs:label "mannelijk geslacht"@nl .

shape:femaleGender a skos:Concept ;
  rdfs:label "female gender"@en ;
  rdfs:label "vrouwelijk geslacht"@nl . 

shape:genderUIShape a o-steps:UIShape ;
  rdfs:label "UI shape: gender"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property [
    sh:path o-persoon:geslacht ;
    sh:in ( shape:genderMale shape:genderFemale) ;
  ] .    


#
# Email address (state)
#
shape:emailAddressShape a o-steps:StateShape ;
  rdfs:label "A citizen's email"@en ;
  rdfs:comment "User with a valid email address"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:emailPattern .

shape:emailPattern a sh:PropertyShape ;
  rdfs:label "Valid email address"@en ;
  sh:path schema:email ;
  sh:pattern "todo" .

#
# Email address (ui)
#
shape:emailAddressUIShape a o-steps:UIShape ;
  rdfs:label "UI shape: email address"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property [
    sh:path schema:email ;
    sh:datatype xsd:string ;
    sh:pattern "todo" ;
  ] .

#
# Mobile phone number
#
shape:mobilePhoneNumberShape a o-steps:StateShape ;
  sh:deactivated true ;
  rdfs:label "A citizen's mobile phone number"@en ;
  rdfs:comment "User with a valid mobile phone number"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property [
    sh:path schema:contactPoint;
    sh:qualifiedValueShape [ 
      sh:path  schema:contactType;
      sh:hasValue "gsm" 
    ] ;
    sh:node [ 
      sh:path schema:telephone;
      sh:minCount 1 
    ];
    sh:qualifiedMinCount 1 ;
  ]  .

#
# phone number
#
shape:phoneNumberShape a o-steps:StateShape ;
  sh:deactivated true ;
  rdfs:label "A citizen's phone number"@en ;
  rdfs:comment "User with a valid phone number"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property [
    sh:path schema:contactPoint;
    sh:qualifiedValueShape [ 
      sh:path  schema:contactType;
      sh:hasValue "telephone" 
    ] ;
    sh:node [ 
      sh:path schema:telephone;
      sh:minCount 1 
    ];
    sh:qualifiedMinCount 1 ;
  ] .



#
# national number
#
shape:nationalNumberBelgiumShape a o-steps:StateShape ;
  rdfs:label "Householder national number"@en ;
  rdfs:comment "User with valid Belgian national number"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:nationalNumberPatternBelgium ;
  sh:property shape:nationalNumberObliged .

shape:nationalNumberPatternBelgium a sh:PropertyShape ;
  rdfs:label "The regular expression of a Belgian national number"@en ;
  rdfs:label "De reguliere expressie van een Belgisch Rijksregisternummer"@nl ;
  rdfs:label "Der reguläre Ausdruck einer belgischen Reichsregisternummer"@de ;
  sh:path o-persoon:registratie .
# This statement raises syntax errors in n3
#  sh:pattern """^[0-9]{2}[.\- ]{0,1}[0-9]{2}[.\- ]{0,1}[0-9]{2}[.\- ]{0,1}[0-9]{3}[.\- ]{0,1}[0-9]{2}$""" .

shape:nationalNumberObliged a sh:PropertyShape ;
  rdfs:label "Obliged national number"@en ;
  rdfs:label "Verplicht nationaal nummer"@nl ;
  rdfs:label "Benötigte Personenkennzeichnung"@de ;
  rdfs:comment "There can be exactly one national number"@en ;
  rdfs:comment "Er kan precies één nationaal nummer zijn"@nl ;
  rdfs:comment "Es kann nur genau eine Personenkennzeichnung geben"@de ;
  sh:path ex:nationalNumber ;
  sh:minCount 1 ;
  sh:maxCount 1 .

#
# national number (ui)
#
shape:nationalNumberUIShape a o-steps:UIShape ;
  rdfs:label "UI shape: national number"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property [
    sh:path o-persoon:registratie ;
    sh:datatype xsd:string ;
    # original pattern (without escaping): "^[0-9]{2}[.\- ]{0,1}[0-9]{2}[.\- ]{0,1}[0-9]{2}[.\- ]{0,1}[0-9]{3}[.\- ]{0,1}[0-9]{2}$" 
    sh:pattern "^[0-9]{2}[.\\- ]{0,1}[0-9]{2}[.\\- ]{0,1}[0-9]{2}[.\\- ]{0,1}[0-9]{3}[.\\- ]{0,1}[0-9]{2}$" ;
  ] .

#
# bank account number (state)
#
shape:bankAccountNumberEuropeShape a o-steps:StateShape ;
  rdfs:label "Citizen bank account number"@en ;
  rdfs:comment "User with valid bank account number"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:bankAccountNumberPatternEurope .

shape:bankAccountNumberPatternEurope a sh:PropertyShape ;
  rdfs:label "IBAN pattern"@en ;
  rdfs:comment "The regular expression of a European bank account number (IBAN)"@en ;
  sh:path ex:bankAccountNumber ;
  sh:pattern "todo" .

#
# bank account number (ui)
#
shape:bankAccountNumberEuropeUIShape a o-steps:UIShape ;
  rdfs:label "UI shape: bank account European"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property [
    sh:path ex:bankAccountNumber ;
    sh:datatype xsd:string ;
  ] .

#
# nationality (state)
#
shape:nationalityShape a o-steps:StateShape ;
  rdfs:label "Citizen nationality"@en ;
  rdfs:comment "User with valid nationality"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:validNationality .

shape:validNationality a sh:PropertyShape ;
  rdfs:label "Valid nationality"@en ;
  sh:path o-persoon:heeftNationaliteit ;
  sh:class o-persoon:Nationaliteit .

#
# nationality (ui)
#
shape:nationalityUIShape a o-steps:UIShape ;
  rdfs:label "UI shape: nationality" ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property [
    sh:path o-persoon:heeftNationaliteit ;
    # todo: there is a class Nationaliteit which links via nationaliteit to country codes (skos:Concept)
  ] .

#
# residence permit (state)
#
shape:residencePermitShape a o-steps:StateShape ;
  rdfs:label "Citizen residence permit"@en ;
  rdfs:comment "User with valid residence permit"@en ;
  rdfs:comment "Assuming that if a Citizen has an official address there is also a residence permit. Needs a change!"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:validResidence .

shape:validResidence a sh:PropertyShape ;
  rdfs:label "Valid residence"@en ;
  rdfs:comment "Assuming that if a Citizen has an official address there is also a residence permit. Needs a change!"@en ;
  sh:path ex:residencePermit ;
  # there is no residence permit in OSLO, first trial was to use Verblijfsplaats instead, but someone can have an address without a residence permit
  # sh:path o-persoon:heeftVerblijfplaats ;
  sh:class o-persoon:Verblijfplaats .

#
# residence permit (ui)
#
shape:residencePermitUIShape a o-steps:UIShape ;
  rdfs:label "UI shape: residence permit"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property [
    sh:path ex:residencePermit ;
    sh:minCount 1 ;
  ] .

#
# birth date (state)
#  
shape:birthDateShape a o-steps:StateShape ;
  rdfs:label "Citizen birth date"@en ;
  rdfs:comment "User with a valid birth date"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:validBirth .

shape:validBirth a sh:PropertyShape ;
  rdfs:label "Valid date of birth"@en ;
  sh:path o-persoon:heeftGeboorte ;
  sh:minCount 1 ;
  sh:maxCount 1 ;
  sh:class o-persoon:Geboorte ;
  sh:node ops:PersoonsgebeurtenisShape .

#
# birth date (ui)
#
shape:birthDateUIShape a o-steps:UIShape ;
  rdfs:label "UI shape: birthdate"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property [
    sh:path ( o-persoon:heeftGeboorte o-persoon:datum ) ;
    sh:datatype xsd:date ;
  ] .

#
# city of birth (state)
#
shape:cityOfBirthShape a o-steps:StateShape ;
  rdfs:label "Citizen city of birth"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:validBirth .

#
# city of birth (ui)
#
shape:cityOfbirthUIShape a o-steps:UIShape ;
  rdfs:label "UI shape: city of birth" ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property [ 
    sh:path ( o-persoon:heeftGeboorte o-persoon:plaats ) ;
    # todo: type of this attribute is http://purl.org/dc/terms/Location
  ] .

#
# address
#
shape:addressShape a o-steps:StateShape ;
  rdfs:label "Citizen address"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:validAddress .

shape:validAddress a sh:PropertyShape ;
  rdfs:label "valid address"@en ;
  sh:path o-persoon:verblijfsadres ;
  sh:node ops:VerblijfplaatsShape .

#
# profession
#
shape:professionShape a o-steps:StateShape ;
  rdfs:label "Citizen profession"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:validProfession .

shape:validProfession a sh:PropertyShape ;
  rdfs:label "Valid profession" ;
  sh:path schema:hasOccupation ;
  sh:minCount 1 .

#
# number of family members
#
shape:numberOfFamilyMembersShape a o-steps:StateShape ;
  rdfs:label "Citizen number of family members"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:validNumberOfFamilyMembers .

shape:validNumberOfFamilyMembers a sh:PropertyShape ;
  rdfs:label "valid number of family members"@en ;
  sh:path ex:numberOfFamilyMembers ;
  sh:minInclusive 1 .

#
# moving date
#
shape:movingDateShape a o-steps:StateShape ;
  rdfs:label "Citizen moving date"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:validMovingDate .

shape:validMovingDate a sh:PropertyShape ;
  rdfs:label "valid date" ;
  sh:path ex:movingDate ;
  sh:datatype xsd:date .

#
# moving addres
#
shape:movingAddressShape a o-steps:StateShape ;
  rdfs:label "Citizen moving address"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:validMovingAddress .

shape:validMovingAddress a sh:PropertyShape ;
  rdfs:label "valid moving address"@en ;
  sh:path ex:movingAddress ;
  sh:node ops:VerblijfplaatsShape .
  
#
# billing address
#
shape:billingAddressShape a o-steps:StateShape ;
  rdfs:label "Citizen billing address"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shape:validBillingAddress .

shape:validBillingAddress a sh:PropertyShape ;
  rdfs:label "valid billing address"@en ;
  sh:path ex:billingAddress ;
  sh:node ops:VerblijfplaatsShape .

#
# moving city
# TODO: that should actually be part of a Verblijfsplaats or Adresvoorstelling
#
shape:movingCity a o-steps:State ;
  rdfs:label "City a citizen wants to move to"@en .

#
# 
