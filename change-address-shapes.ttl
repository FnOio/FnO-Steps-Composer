@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix shp: <http://fast.ilabt.imec.be/states#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix ex: <https://example.org/ns/example#> .
@prefix schema: <https://schema.org/> .

# OSLO persoon application profile, because reused terms like first name are in an application profile
@prefix o-persoon: <https://data.vlaanderen.be/doc/applicatieprofiel/persoon-basis#> .

# needed for advanced shacl, to use prefixes in SPARQL query string
<https://schema.org/> sh:prefix "schema" .
<https://data.vlaanderen.be/doc/applicatieprofiel/persoon-basis#> sh:prefix "o-persoon" .


#
# first name
#
shp:firstNameShape a sh:NodeShape ;
  sh:name "A citizen's first name"@en ;
  sh:description "User with valid first name"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shp:firstNameLength .

shp:firstNameLength a sh:PropertyShape ;
  sh:name "First name length constraints"@en ;
  sh:description "Minimum and maximum for a valid first name"@en ;
  sh:path o-persoon:voornaam ;
  sh:minLength 2 ;
  sh:maxLength 25 .

#
# last name
#
shp:lastNameShape a sh:NodeShape ;
  sh:name "A citizen's last name"@en ;
  sh:description "User with valid first name"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shp:lastNameLength .

shp:lastNameLength a sh:PropertyShape ;
  sh:name "First name length constraints"@en ;
  sh:description "Minimum and maximum for a valid first name"@en ;
  sh:path o-persoon:achternaam ;
  sh:minLength 2 ;
  sh:maxLength 25 .

#
# gender constraints (sorry 2019)
#
shp:genderShape a sh:NodeShape ;
  sh:name "A citizen's gender"@en ;
  sh:description "User with a valid gender"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shp:genderValidValues .

shp:genderValidValues a sh:PropertyShape ;
  sh:name "Valid gender values"@en ;
  sh:path o-persoon:geslacht ;
  sh:in ( "male" "female" ) .

#
# Email address
#
shp:emailAddressShape a sh:NodeShape ;
  sh:name "A citizen's email"@en ;
  sh:description "User with a valid email address"@en ;
  sh:targetClass o-persoon:Inwoner ;
  sh:property shp:emailPattern .

shp:emailPattern a sh:PropertyShape ;
  sh:name "Valid email address"@en ;
  sh:path schema:email ;
  sh:pattern "todo" .

#
# Mobile phone number
#
shp:mobilePhoneNumberShape a sh:NodeShape ;
  sh:name "A citizen's mobile phone number"@en ;
  sh:description "User with a valid mobile phone number"@en ;
  sh:targetClass o-persoon:Inwoner ;
  # this is wrong, it says that additionally all person's mobile phone numbers should be valid, not just the one from this person
  sh:and ( shp:validMobilePhoneNumber ) .


# this shape targets all contactPoints with type 'mobile' or 'gsm' of a person
shp:validMobilePhoneNumber a sh:NodeShape ;
  sh:name "Valid mobile phone number"@en ;
  sh:target [
    a sh:SPARQLTarget ;
    sh:select """
      SELECT ?this
      WHERE {
        ?person a <https://data.vlaanderen.be/doc/applicatieprofiel/persoon-basis#Inwoner> ;
             <https://data.vlaanderen.be/doc/applicatieprofiel/persoon-basis#contactinfo> ?this .

        ?this <https://schema.org/contactType> ?type .

        FILTER( ?type IN ("mobile" "gsm") )
      }
    """ ;
  ] ;
  sh:and ( shp:mobilePhoneNumberPattern ) .

shp:mobilePhoneNumberPattern a sh:PropertyShape ;
  sh:name "Valid mobile phone number"@en ;
  sh:path schema:telephone ;
  sh:pattern "todo" .

#
# phone number
#
shp:phoneNumberShape a sh:NodeShape ;
  sh:name "A citizen's phone number"@en ;
  sh:description "User with a valid phone number"@en ;
  sh:targetClass o-persoon:Inwoner ;
  # this is wrong, it says that additionally all person's mobile phone numbers should be valid, not just the one from this person
  sh:and ( shp:validPhoneNumber ) .

# this shape targets all contactPoints with type 'phone' of a person
shp:validPhoneNumber a sh:NodeShape ;
  sh:name "Valid phone number"@en ;
  sh:target [
    a sh:SPARQLTarget ;
    sh:select """
      SELECT ?this
      WHERE {
        ?person a <https://data.vlaanderen.be/doc/applicatieprofiel/persoon-basis#Inwoner> ;
             <https://data.vlaanderen.be/doc/applicatieprofiel/persoon-basis#contactinfo> ?this .

        ?this <https://schema.org/contactType> ?type .

        FILTER( ?type IN ("phone") )
      }
    """ ;
  ] ;
  sh:and ( shp:phoneNumberPattern ) .

shp:phoneNumberPattern a sh:PropertyShape ;
  sh:name "Valid phone number"@en ;
  sh:path schema:telephone ;
  sh:pattern "todo" .


